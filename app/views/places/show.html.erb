<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Range Input with Tick Mark Labels</title>
    <style>
        .range-container {
            position: relative;
            width: 300px; /* Adjust based on your range input width */
            margin: 20px;
        }

        .range-labels {
            display: flex;
            justify-content: space-between;
            position: absolute;
            width: 100%;
            top: 40px; /* Adjust this value to move the labels up or down */
            left: 0;
        }

        .range-labels span {
            position: absolute;
            transform: translateX(-50%);
        }

        /* Style the range input for better visibility */
        input[type="range"] {
            width: 100%;
        }
    </style>
</head>



<div>
  <div>
    <h1>
      <%= @the_place.name %> 
    </h1>

    <h2>
      <% @the_place.categories.all.each do |category| %>
        <%= category.name %>
      <% end %>
    </h2>

    <h2>
    Overall rating: <%= @rating_average %>/5.0
    </h2>

    <div>
      <div>
        <a href="/places">
          Go back
        </a>
      </div>

      <div>
        <a href="/update_place/<%= @the_place.id %>">
          Edit place
        </a>
      </div>

      <div>
        <a href="/delete_place/<%= @the_place.id %>">
          Delete place
        </a>
      </div>
    </div>

    <dl>

      <dt>
        Description
      </dt>
      <dd>
        <%= @the_place.description %>
      </dd>
      <dt class="col-sm-3">Image</dt>
        <dd class="col-sm-9">
          <% if @the_place.image.present? %>
            <img src="<%= @the_place.image.url %>" class="img-fluid" alt="<%= @the_place.name %>">
          <% else %>
            <p>No image available.</p>
          <% end %>
        </dd>
      <dt>
        Street address
      </dt>
      <dd>
        <%= @the_place.street_address %>
      </dd>

      <dt>
        City
      </dt>
      <dd>
        <%= @the_place.city %>
      </dd>

      <dt>
        Zip code
      </dt>
      <dd>
        <%= @the_place.zip_code %>
      </dd>

    </dl>
  </div>
</div>



<hr>

<% if current_user != nil && current_user.hometown == @the_place.city %>

  <div>
    <h2>
      Add a new review
    </h2>

    <form action="/insert_review" method="post">
      <div>

        <input type="hidden" id="place_id_box" name="query_place_id" value="<%= @the_place.id %>">
      </div>

      <div>

        <input type="hidden" id="reviewer_id_box" name="query_reviewer_id" value="<%= current_user.id %>">
      </div>

      <div class="range-container">
        <label for="rating_box">Rating</label>
          <input type="range" list="tickmarks" step="0.5" min="1.0" max="5.0" id="rating_box" name="query_rating" />
          <datalist id="tickmarks">
            <option value="1.0"></option>
            <option value="1.5"></option>
            <option value="2.0"></option>
            <option value="2.5"></option>
            <option value="3.0"></option>
            <option value="3.5"></option>
            <option value="4.0"></option>
            <option value="4.5"></option>
            <option value="5.0"></option>
          </datalist>

          <div class="range-labels">
            <span style="left: 0%;">1.0</span>
            <span style="left: 12.5%;">1.5</span>
            <span style="left: 25%;">2.0</span>
            <span style="left: 37.5%;">2.5</span>
            <span style="left: 50%;">3.0</span>
            <span style="left: 62.5%;">3.5</span>
            <span style="left: 75%;">4.0</span>
            <span style="left: 87.5%;">4.5</span>
            <span style="left: 100%;">5.0</span>
          </div>
      </div>

      <div>
        <label for="body_box">
          Body
        </label>

        <textarea id="body_box" name="query_body" rows="3"></textarea>
      </div>

      <button>
        Create review
      </button>
    </form>
  </div>


  <% elsif current_user != nil && current_user.hometown != @the_place.city  %>

  You can only add reviews for places in <%= current_user.hometown %>
  
  
  <% else %>

  <div>
  Want to add a review?

  <a href="/users/sign_up">Sign up</a>
  <a href="/users/sign_in">Sign in</a>

  </div>

  <% end %>

<hr>


<h2>Existing reviews for <%= @the_place.name %></h2>

<table border="1">
  <tr>

    <th>
      Reviewer
    </th>

    <th>
      Rating
    </th>

    <th>
      Description
    </th>

    <th>
      Date
    </th>

  </tr>

  <% @the_place.reviews.each do |a_review| %>
    <tr>
      <td>
        <% the_id = a_review.reviewer_id  %>
        <% matching_records = User.where({ :id => the_id}) %>
        <% reviewer = matching_records.at(0) %>

        <%= reviewer.full_name %>
      </td>

      <td>
        <%= a_review.rating %>
      </td>

      <td>
        <%= a_review.body %>
      </td>

      <td>
        <%= a_review.created_at.to_date%>
      </td>

    </tr>
  <% end %>
</table>
